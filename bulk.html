<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Códigos QR Gratis | WiFi, WhatsApp y Logo | QR Free</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6481587162431047" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/714/714390.png"> 

</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <div class="brand"><i class="fa-solid fa-cube"></i> QR Enterprise</div>
            <div class="nav-links">
                <a href="index.html"><i class="fa-solid fa-qrcode"></i> <span>Individual</span></a>
                <a href="bulk.html" class="active"><i class="fa-solid fa-layer-group"></i> <span>Masivo & Barcode</span></a>
            </div>
        </div>
    </nav>

    <main class="main-wrapper">
        <div class="page-header">
            <h1>Centro de Procesamiento Masivo</h1>
            <p>Automatice la creación de miles de códigos QR o de Barras utilizando hojas de cálculo.</p>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('qr')"><i class="fa-solid fa-qrcode"></i> Lote QRs</button>
            <button class="tab-btn" onclick="switchTab('barcode')"><i class="fa-solid fa-barcode"></i> Lote Barcodes</button>
        </div>

        <div class="tutorial-wrapper">
            <div class="tutorial-header">
                <div>
                    <h3 style="color:var(--primary); margin-bottom:5px;"><i class="fa-solid fa-graduation-cap"></i> Guía de Uso Rápido</h3>
                    <p style="font-size:0.9rem; color:var(--text-light); margin:0;">Siga estos pasos para evitar errores en la generación.</p>
                </div>
                <button class="btn btn-primary" style="width:auto; padding: 10px 20px; background-color: #107c41;" onclick="downloadExcelTemplate()">
                    <i class="fa-solid fa-file-excel"></i> Descargar Plantilla Excel
                </button>
            </div>
            <div class="tutorial-content">
                <div>
                    <ul class="step-list">
                        <li class="step-item">
                            <h4>Prepare su Excel (.xlsx)</h4>
                            <p>Necesita dos columnas: una con la información (URL, Texto, Código) y otra opcional para el nombre del archivo.</p>
                        </li>
                        <li class="step-item">
                            <h4>Configure el Diseño</h4>
                            <p>Use las opciones de abajo para definir colores, formas y formatos de salida antes de procesar.</p>
                        </li>
                        <li class="step-item">
                            <h4>Mapeo de Columnas</h4>
                            <p>Al subir el archivo, seleccione qué columna corresponde a los Datos y cuál al Nombre.</p>
                        </li>
                    </ul>
                    <div class="info-box">
                        <strong><i class="fa-solid fa-triangle-exclamation"></i> Nota Técnica:</strong>
                        El sistema ignorará automáticamente la primera fila (encabezados).
                    </div>
                </div>
                
                <div>
                    <p style="font-size:0.8rem; font-weight:bold; margin-bottom:10px; color:var(--text-light);">Estructura recomendada:</p>
                    <div class="fake-excel">
                        <div class="excel-header">
                            <span>A</span>
                            <span style="margin-left:45%;">B</span>
                        </div>
                        <div class="excel-row" style="background:#f9fafb; font-weight:bold;">
                            <div class="excel-cell">Contenido_QR</div>
                            <div class="excel-cell">Nombre_Archivo</div>
                        </div>
                        <div class="excel-row">
                            <div class="excel-cell highlight">https://miweb.com/prod1</div>
                            <div class="excel-cell">producto_001</div>
                        </div>
                        <div class="excel-row">
                            <div class="excel-cell highlight">WIFI:S:MiRed;P:123;;</div>
                            <div class="excel-cell">wifi_oficina</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="bulk-layout">
            <div id="tab-qr" class="tab-content active">
                <div style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 30px; align-items: start;">
                    
                    <section class="panel">
                        <div class="panel-title"><i class="fa-solid fa-sliders"></i> Diseño del Lote</div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div style="background: #f8fafc; padding: 15px; border-radius: 6px; border: 1px solid var(--border);">
                                <h4 style="font-size:0.8rem; color:var(--text-light); margin-bottom:10px; text-transform:uppercase; border-bottom:1px solid #e2e8f0; padding-bottom:5px;">
                                    1. Cuerpo (Datos)
                                </h4>
                                <div class="form-group">
                                    <label>Forma Puntos</label>
                                    <select id="bulk-qr-dots" onchange="updateBulkPreview()">
                                        <option value="square">Cuadrado</option>
                                        <option value="rounded">Redondo</option>
                                        <option value="dots">Puntos</option>
                                        <option value="classy">Classy</option>
                                        <option value="classy-rounded">Classy Smooth</option>
                                        <option value="extra-rounded">Extra Redondo</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Color Puntos</label>
                                    <div style="display:flex; align-items:center; gap:10px;">
                                        <input type="color" id="bulk-qr-color" value="#0f172a" style="height:35px; width:50px; flex-shrink:0;" oninput="updateBulkPreview()">
                                        <span style="font-size:0.8rem; color:var(--text-light);">Principal</span>
                                    </div>
                                </div>
                            </div>

                            <div style="background: #f8fafc; padding: 15px; border-radius: 6px; border: 1px solid var(--border);">
                                <h4 style="font-size:0.8rem; color:var(--text-light); margin-bottom:10px; text-transform:uppercase; border-bottom:1px solid #e2e8f0; padding-bottom:5px;">
                                    2. Esquinas (Ojos)
                                </h4>
                                <div class="form-group">
                                    <label>Forma Esquinas</label>
                                    <select id="bulk-qr-corners" onchange="updateBulkPreview()">
                                        <option value="square">Cuadrado (Clásico)</option>
                                        <option value="extra-rounded">Extra Redondo (Moderno)</option>
                                        <option value="dot">Punto (Círculo)</option>
                                        <option value="rounded">Redondeado Suave</option>
                                        <option value="classy">Classy (Elegante)</option>
                                        <option value="classy-rounded">Classy Curvo</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Color Esquinas</label>
                                    <div style="display:flex; align-items:center; gap:10px;">
                                        <input type="color" id="bulk-qr-corners-color" value="#0f172a" style="height:35px; width:50px; flex-shrink:0;" oninput="updateBulkPreview()">
                                        <span style="font-size:0.8rem; color:var(--text-light);">Ojos</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: 20px;">
                            <h4 style="font-size:0.8rem; color:var(--text-light); margin-bottom:10px; text-transform:uppercase;">3. Branding</h4>
                            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px;">
                                <div class="form-group">
                                    <label>Color Fondo</label>
                                    <input type="color" id="bulk-qr-bg" value="#ffffff" style="height:40px;" oninput="updateBulkPreview()">
                                </div>
                                <div class="form-group">
                                    <label>Logo Central (Opcional)</label>
                                    <div class="logo-upload-container" style="padding: 8px;">
                                        <div class="upload-placeholder" id="bulkUploadPlaceholder" onclick="document.getElementById('bulkLogoInput').click()" style="display:flex; align-items:center; justify-content:center; gap:10px;">
                                            <i class="fa-solid fa-cloud-arrow-up" style="color:var(--accent);"></i>
                                            <span style="font-size:0.8rem; color:var(--text-light);">Subir Logo</span>
                                        </div>
                                        <div class="logo-preview-wrapper" id="bulkLogoPreviewArea" style="display:none; flex-direction:row;">
                                            <img src="" alt="Preview" class="logo-preview-img" id="bulkImgPreview" style="max-height:40px;">
                                            <button class="btn btn-danger" onclick="removeBulkLogo()" style="padding: 5px 10px; font-size: 0.7rem;">X</button>
                                        </div>
                                        <input type="file" id="bulkLogoInput" accept="image/*" hidden onchange="handleBulkLogoUpload(this)">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: 20px; background: #f0fdf4; padding: 15px; border-radius: 6px; border: 1px solid #bbf7d0;">
                            <h4 style="font-size:0.8rem; color:#15803d; margin-bottom:10px; text-transform:uppercase; border-bottom:1px solid #86efac; padding-bottom:5px;">
                                4. Configuración de Salida
                            </h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div class="form-group">
                                    <label>Formato de Archivo</label>
                                    <select id="bulk-export-format">
                                        <option value="png">PNG (Imagen)</option>
                                        <option value="jpeg">JPEG (Ligero)</option>
                                        <option value="svg">SVG (Vectorial)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Tamaño / Resolución</label>
                                    <select id="bulk-export-size">
                                        <option value="500">500 x 500 px (Web)</option>
                                        <option value="1000" selected>1000 x 1000 px (Alta)</option>
                                        <option value="2000">2000 x 2000 px (4K)</option>
                                        <option value="4000">4000 x 4000 px (Gigante)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section class="panel" style="text-align: center; position: sticky; top: 20px;">
                        <div class="panel-title" style="justify-content: center; border:none; margin-bottom:10px;">
                            <i class="fa-solid fa-eye"></i> Vista Previa Lote
                        </div>
                        <div id="bulk-canvas-preview" style="background:white; padding:15px; border-radius:8px; box-shadow:var(--shadow); display:inline-block; border: 1px solid #f1f5f9;"></div>
                        <div style="margin-top: 15px; font-size: 0.85rem; color: var(--text-light); background: #f0f9ff; padding: 10px; border-radius: 4px;">
                            <i class="fa-solid fa-info-circle"></i> Todos los QRs del Excel heredarán este diseño.
                        </div>
                    </section>
                </div>
            </div>

            <div id="tab-barcode" class="tab-content">
                <section class="panel">
                    <div class="panel-title"><i class="fa-solid fa-barcode"></i> Configuración del Lote Barcode</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div class="form-group">
                            <label>Formato Industrial</label>
                            <select id="bulk-bar-format">
                                <option value="CODE128">Code 128 (Universal)</option>
                                <option value="EAN13">EAN-13 (Retail)</option>
                                <option value="UPC">UPC (USA)</option>
                                <option value="CODE39">Code 39 (Industria)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Etiqueta de Texto</label>
                            <select id="bulk-bar-text">
                                <option value="true">Mostrar Código</option>
                                <option value="false">Solo Barras</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Color Barras</label>
                            <input type="color" id="bulk-bar-color" value="#000000" style="height:40px;">
                        </div>
                    </div>
                </section>
            </div>

            <section class="panel">
                <div class="panel-title"><i class="fa-solid fa-cloud-arrow-up"></i> Carga de Archivo</div>
                
                <div class="upload-area" id="drop-zone" onclick="document.getElementById('excel-input').click()">
                    <i class="fa-solid fa-file-excel fa-3x" style="color:#10b981; margin-bottom:15px;"></i>
                    <h3>Click para subir Excel (.xlsx)</h3>
                    <p style="color:var(--text-light); font-size:0.9rem;">Recomendado: Máximo 500 registros por lote.</p>
                    <input type="file" id="excel-input" accept=".xlsx, .xls, .csv" hidden>
                </div>

                <div id="bulk-controls" style="display: none; margin-top: 25px;">
                    <div style="background:#f0f9ff; padding:15px; border-radius:4px; margin-bottom:20px; border:1px solid #bae6fd; display:flex; align-items:center; gap:10px;">
                        <i class="fa-solid fa-check-circle" style="color:var(--accent);"></i>
                        <span id="record-count" style="font-weight:700; color:var(--text-dark);">0 Registros listos</span>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div class="form-group">
                            <label>1. Columna de DATOS</label>
                            <select id="col-data" style="background:#fffbeb; border-color:#f59e0b;"></select>
                            <small style="color:var(--text-light);">La columna con la URL o Código.</small>
                        </div>
                        <div class="form-group">
                            <label>2. Columna NOMBRE (Opcional)</label>
                            <select id="col-name"></select>
                            <small style="color:var(--text-light);">Para nombrar los archivos.</small>
                        </div>
                    </div>

                    <div id="progress-container" style="display:none; margin-bottom:15px;">
                        <div style="background:#e2e8f0; height:12px; border-radius:6px; overflow:hidden;">
                            <div id="progress-fill" style="background:var(--accent); width:0%; height:100%; transition: width 0.1s linear;"></div>
                        </div>
                        <p id="progress-text" style="text-align:center; font-size:0.85rem; margin-top:5px; font-weight:bold; color:var(--primary);">Iniciando...</p>
                    </div>

                    <button class="btn btn-primary" onclick="processBulkData()">
                        <i class="fa-solid fa-cogs"></i> Procesar Lote y Generar ZIP
                    </button>
                </div>
            </section>
        </div>
    </main>

    <script src="main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', initBulkPage);
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.getElementById('tab-' + tab).classList.add('active');
            window.currentBulkMode = tab;
        }
        window.currentBulkMode = 'qr';
    </script>
</body>
</html>